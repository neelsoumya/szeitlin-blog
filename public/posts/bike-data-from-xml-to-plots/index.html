<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>My New Hugo Site </title>
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">

    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="generator" content="Hugo 0.32.2" />
    
    
      <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">
    

    <link href='http://example.org/dist/main.css' rel='stylesheet' type="text/css" />
    
      
    

    

    <meta property="og:title" content="" />
<meta property="og:description" content="Last month, I was looking for some fun time series data to hack on. Turns out bike computers provide a great way to interface between your friends&rsquo; unfounded modesty and their actual rides.
One friend was kind enough to donate some data for my entertainment. This friend wears spandex, rides a titanium frame road bike, and sweats a lot. I knew he was a strong cyclist. He&rsquo;s also relatively consistent, which meant the data he gave me wasn&rsquo;t too terribly noisy." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://example.org/posts/bike-data-from-xml-to-plots/" />
















<meta itemprop="name" content="">
<meta itemprop="description" content="Last month, I was looking for some fun time series data to hack on. Turns out bike computers provide a great way to interface between your friends&rsquo; unfounded modesty and their actual rides.
One friend was kind enough to donate some data for my entertainment. This friend wears spandex, rides a titanium frame road bike, and sweats a lot. I knew he was a strong cyclist. He&rsquo;s also relatively consistent, which meant the data he gave me wasn&rsquo;t too terribly noisy.">



<meta itemprop="wordCount" content="682">



<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary"/><meta name="twitter:title" content=""/>
<meta name="twitter:description" content="Last month, I was looking for some fun time series data to hack on. Turns out bike computers provide a great way to interface between your friends&rsquo; unfounded modesty and their actual rides.
One friend was kind enough to donate some data for my entertainment. This friend wears spandex, rides a titanium frame road bike, and sweats a lot. I knew he was a strong cyclist. He&rsquo;s also relatively consistent, which meant the data he gave me wasn&rsquo;t too terribly noisy."/>

  </head>

  <body class="ma0 avenir bg-near-white">

    

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="http://example.org/" class="f3 fw2 hover-white no-underline white-90 dib">
      My New Hugo Site
    </a>
    <div class="flex-l items-center">
      
      








    </div>
  </div>
</nav>

    </div>
  </header>


    <main class="pb7" role="main">
      
  <div class="flex-l mt2 mw8 center">
    <article class="center cf pv5 ph3 ph4-ns mw7">
      <header>
        <p class="f6 b helvetica tracked">
          POSTS
        </p>
        <h1 class="f1">
          
        </h1>
      </header>
      <div class="nested-copy-line-height lh-copy f4 nested-links nested-img mid-gray">
        <p>Last month, I was looking for some fun time series data to hack on. Turns out <a href="http://www.garmin.com/en-US" title="Garmin">bike computers</a>  provide a great way to interface between your friends&rsquo; unfounded modesty and their actual rides.</p>

<p>One friend was kind enough to donate some data for my entertainment. This friend wears spandex, rides a titanium frame road bike, and sweats a lot. I knew he was a strong cyclist. He&rsquo;s also relatively consistent, which meant the data he gave me wasn&rsquo;t too terribly noisy. But everyone forgets to turn on the computer sometimes, or forgets to charge the battery.</p>

<p>Garmin has an app that lets you export data from the puny bike computer and, I guess, view it. But I wanted to do more analysis, so I tried a few things. Exporting the data as regular CSV seemed to work at first, but when I went to view the data, it was missing most of the information I wanted, like time and distance.</p>

<p>Eventually I realized the only way to get the values I wanted was to export as XML, which I had heard was not fun to parse.</p>

<p>A snapshot of the file looks like this:
[code lang=&ldquo;XML&rdquo;]
&lt;?xml version=&ldquo;1.0&rdquo; encoding=&ldquo;UTF-8&rdquo; standalone=&ldquo;no&rdquo; ?&gt;
<TrainingCenterDatabase xmlns="http://www.garmin.com/xmlschemas/TrainingCenterDatabase/v2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.garmin.com/xmlschemas/ActivityExtension/v2 http://www.garmin.com/xmlschemas/ActivityExtensionv2.xsd http://www.garmin.com/xmlschemas/FatCalories/v1 http://www.garmin.com/xmlschemas/fatcalorieextensionv1.xsd http://www.garmin.com/xmlschemas/TrainingCenterDatabase/v2 http://www.garmin.com/xmlschemas/TrainingCenterDatabasev2.xsd"></p>

<p><Folders/></p>

<p><Activities>
    <Activity Sport="Biking">
      <Id>2013-06-11T23:18:21Z</Id>
      <Lap StartTime="2013-06-11T23:18:21Z">
        <TotalTimeSeconds>1669.7500000</TotalTimeSeconds>
        <DistanceMeters>14122.1464844</DistanceMeters>
        <MaximumSpeed>11.1599998</MaximumSpeed>
        <Calories>575</Calories>
        <Intensity>Active</Intensity>
        <Cadence>0</Cadence>
        <TriggerMethod>Manual</TriggerMethod>
        <Extensions>
          <FatCalories xmlns="http://www.garmin.com/xmlschemas/FatCalories/v1">
            <Value>0</Value>
          </FatCalories>
          <LX xmlns="http://www.garmin.com/xmlschemas/ActivityExtension/v2">
            <AvgSpeed>8.4576416</AvgSpeed>
          </LX>
        </Extensions>
      </Lap>
      <Lap StartTime="2013-06-12T00:42:37Z">[/code]</p>

<p>Unexpectedly, the links in the file that were supposed to tell me the schema were all outdated (this bike computer is not exactly the newest model). So I hunted around a bit and found I could use <a href="http://lxml.de/1.3/objectify.html" title="LXML objectify">lxml objectify</a>. This let me parse the XML, starting with the root. Then I could &ldquo;walk&rdquo; along the tree to figure out what was where.</p>

<p>In practice, without a useful map of the schema, &ldquo;walking the tree&rdquo; was more like hiking the Appalachian Trail (by which I mean, full of rocks) than a pleasant stroll. Eventually, I found <a href="http://www8.garmin.com/xmlschemas/TrainingCenterDatabasev2.xsd" title="tcx schema">this file</a>, which helped somewhat.</p>

<p>Even with more of a map, the structure seems strange. Some values were nested for no apparent reason (maybe that&rsquo;s typical for XML? I don&rsquo;t know). Some basic calculations for obvious things (like average speed) were added separately as &ldquo;Extensions&rdquo;, like an afterthought.</p>

<p>[code lang=&ldquo;python&rdquo;]
import pandas
from lxml import objectify
path = &ldquo;2013_xml.tcx&rdquo;
parsed = objectify.parse(open(path))
root = parsed.getroot()
root.Activities.Activity.Lap.descendantpaths() [/code]</p>

<p>Which told me the actual structure looks more like this:</p>

<p>[code]
[u&rsquo;{<a href="http://www.garmin.com/xmlschemas/TrainingCenterDatabase/v2}Lap'">http://www.garmin.com/xmlschemas/TrainingCenterDatabase/v2}Lap'</a>,
 u&rsquo;{<a href="http://www.garmin.com/xmlschemas/TrainingCenterDatabase/v2}Lap.TotalTimeSeconds'">http://www.garmin.com/xmlschemas/TrainingCenterDatabase/v2}Lap.TotalTimeSeconds'</a>,
 u&rsquo;{<a href="http://www.garmin.com/xmlschemas/TrainingCenterDatabase/v2}Lap.DistanceMeters'">http://www.garmin.com/xmlschemas/TrainingCenterDatabase/v2}Lap.DistanceMeters'</a>,
 u&rsquo;{<a href="http://www.garmin.com/xmlschemas/TrainingCenterDatabase/v2}Lap.MaximumSpeed'">http://www.garmin.com/xmlschemas/TrainingCenterDatabase/v2}Lap.MaximumSpeed'</a>,
 u&rsquo;{<a href="http://www.garmin.com/xmlschemas/TrainingCenterDatabase/v2}Lap.Calories'">http://www.garmin.com/xmlschemas/TrainingCenterDatabase/v2}Lap.Calories'</a>,
 u&rsquo;{<a href="http://www.garmin.com/xmlschemas/TrainingCenterDatabase/v2}Lap.Intensity'">http://www.garmin.com/xmlschemas/TrainingCenterDatabase/v2}Lap.Intensity'</a>,
 u&rsquo;{<a href="http://www.garmin.com/xmlschemas/TrainingCenterDatabase/v2}Lap.Cadence'">http://www.garmin.com/xmlschemas/TrainingCenterDatabase/v2}Lap.Cadence'</a>,
 u&rsquo;{<a href="http://www.garmin.com/xmlschemas/TrainingCenterDatabase/v2}Lap.TriggerMethod'">http://www.garmin.com/xmlschemas/TrainingCenterDatabase/v2}Lap.TriggerMethod'</a>,
 u&rsquo;{<a href="http://www.garmin.com/xmlschemas/TrainingCenterDatabase/v2}Lap.Extensions'">http://www.garmin.com/xmlschemas/TrainingCenterDatabase/v2}Lap.Extensions'</a>,
 u&rsquo;{<a href="http://www.garmin.com/xmlschemas/TrainingCenterDatabase/v2}Lap.Extensions.{http://www.garmin.com/xmlschemas/FatCalories/v1}FatCalories'">http://www.garmin.com/xmlschemas/TrainingCenterDatabase/v2}Lap.Extensions.{http://www.garmin.com/xmlschemas/FatCalories/v1}FatCalories'</a>,
 u&rsquo;{<a href="http://www.garmin.com/xmlschemas/TrainingCenterDatabase/v2}Lap.Extensions.{http://www.garmin.com/xmlschemas/FatCalories/v1}FatCalories.Value'">http://www.garmin.com/xmlschemas/TrainingCenterDatabase/v2}Lap.Extensions.{http://www.garmin.com/xmlschemas/FatCalories/v1}FatCalories.Value'</a>,
 u&rsquo;{<a href="http://www.garmin.com/xmlschemas/TrainingCenterDatabase/v2}Lap.Extensions.{http://www.garmin.com/xmlschemas/ActivityExtension/v2}LX'">http://www.garmin.com/xmlschemas/TrainingCenterDatabase/v2}Lap.Extensions.{http://www.garmin.com/xmlschemas/ActivityExtension/v2}LX'</a>,
 u&rsquo;{<a href="http://www.garmin.com/xmlschemas/TrainingCenterDatabase/v2}Lap.Extensions.{http://www.garmin.com/xmlschemas/ActivityExtension/v2}LX.AvgSpeed']">http://www.garmin.com/xmlschemas/TrainingCenterDatabase/v2}Lap.Extensions.{http://www.garmin.com/xmlschemas/ActivityExtension/v2}LX.AvgSpeed']</a>
[/code]</p>

<p>And just to make it more fun, in some cases, the data was the &ldquo;value&rdquo;, in some cases it was the &ldquo;text&rdquo;, in some cases it was the &ldquo;pyval&rdquo; (python-friendly version of otherwise deeply nested values). In some cases, where the values were &ldquo;text&rdquo; that meant they were strings when I needed floats. So I had to drill down, and then drill down some more, and convert everything, and it still isn&rsquo;t obvious to me why they structured it this way. But I parsed out the things I wanted and wrote them to lists:</p>

<p>[code lang=&ldquo;python&rdquo;]
for activity in root.Activities.Activity:
    for lap in activity.Lap:
        StartTime.append(lap.values()[0])
        TotalTimeSeconds.append(float(lap.TotalTimeSeconds.text))
        DistanceMeters.append(float(lap.DistanceMeters.text))
        MaximumSpeed.append(float(lap.MaximumSpeed.text))
        Calories.append(float(lap.Calories.text))</p>

<pre><code>    kids= lap.Extensions.getchildren()
    avgspeed = kids[1].AvgSpeed.pyval       #use pyval to get rid of nested brackets 
    AvgSpeedList.append(avgspeed)
</code></pre>

<p>[/code]</p>

<p>Of course that was just a first pass, and I quickly realized things were still not very pretty. I got rid of extra decimal places, and converted each list to a pandas Series so I could concatenate them together into a big dataframe. For example:</p>

<p>[code lang=&ldquo;python&rdquo;]
AverageSpeed = pandas.Series(AvgSpeedList)
AverageSpeed = AverageSpeed.round(2)</p>

<p>#join Series as columns in a new dataframe
df = pandas.concat([StartTime, TotalTimeSeconds, DistanceMeters, <br />
MaximumSpeed, Calories, AverageSpeed], axis=1)</p>

<p>#rename the columns to something useful
df.columns = [&lsquo;StartTime&rsquo;,&lsquo;TotalTimeSeconds&rsquo;, &lsquo;DistanceMeters&rsquo;, <br />
&lsquo;MaximumSpeed&rsquo;, &lsquo;Calories&rsquo;, &lsquo;AverageSpeed&rsquo;]</p>

<p>[/code]</p>

<p>Finally! Now the data table looked more like this:</p>

<p>[code]
StartTime      TotalTimeSeconds DistanceMeters  MaximumSpeed    Calories    AverageSpeed
2013-06-11T23:18:21Z     1669.75     14122.15    11.16            575            8.46</p>

<p>[/code]</p>

<p>But as I&rsquo;m finding with these low-level data science tools, just getting numbers into a table isn&rsquo;t going to tell you much, and every different question you want to ask, every plot you want to make, means making additional tables, usually with a lot more rearranging. (More on that in <a href="http://codrspace.com/szeitlin/biking-data-from-xml-to-plots-part-2/">part 2</a>)</p>

      </div>
    </article>
    <aside class="ph3 mt2 mt6-ns">
      







  <div class="bg-light-gray pa3">
    <ul>
      <li class="list b mb3">
        29 More Posts
      </li>
      
        <li class="list f5 w-100 hover-bg-white nl1">
          
          <a href="/posts/airflow-for-hands-off-etl/" class="link ph2 pv2 db black">
            
          </a>
        </li>
      
        <li class="list f5 w-100 hover-bg-white nl1">
          
          <a href="/posts/automating-user-friendly-documentation-using-selenium-/" class="link ph2 pv2 db black">
            
          </a>
        </li>
      
        <li class="list f5 w-100 hover-bg-white nl1">
          
          <a href="/posts/bike-data-from-xml-to-plots/" class="link ph2 pv2 db black o-50">
            
          </a>
        </li>
      
        <li class="list f5 w-100 hover-bg-white nl1">
          
          <a href="/posts/biking-data-from-xml-to-plots-part-2/" class="link ph2 pv2 db black">
            
          </a>
        </li>
      
        <li class="list f5 w-100 hover-bg-white nl1">
          
          <a href="/posts/biking-data-from-xml-to-plots-part-3/" class="link ph2 pv2 db black">
            
          </a>
        </li>
      
        <li class="list f5 w-100 hover-bg-white nl1">
          
          <a href="/posts/biking-data-from-xml-to-plots-part-4/" class="link ph2 pv2 db black">
            
          </a>
        </li>
      
        <li class="list f5 w-100 hover-bg-white nl1">
          
          <a href="/posts/biking-data-from-xml-to-plots-revised/" class="link ph2 pv2 db black">
            
          </a>
        </li>
      
        <li class="list f5 w-100 hover-bg-white nl1">
          
          <a href="/posts/converting-a-python-script-to-a-spark-pipeline/" class="link ph2 pv2 db black">
            
          </a>
        </li>
      
        <li class="list f5 w-100 hover-bg-white nl1">
          
          <a href="/posts/data-pipelining-with-pandas-automating-lookup-and-update/" class="link ph2 pv2 db black">
            
          </a>
        </li>
      
        <li class="list f5 w-100 hover-bg-white nl1">
          
          <a href="/posts/faq-why-and-how-i-learned-to-code/" class="link ph2 pv2 db black">
            
          </a>
        </li>
      
        <li class="list f5 w-100 hover-bg-white nl1">
          
          <a href="/posts/fun-with-failing/" class="link ph2 pv2 db black">
            
          </a>
        </li>
      
        <li class="list f5 w-100 hover-bg-white nl1">
          
          <a href="/posts/game-plan-for-conferences-with-high-risk-of-harassment/" class="link ph2 pv2 db black">
            
          </a>
        </li>
      
        <li class="list f5 w-100 hover-bg-white nl1">
          
          <a href="/posts/importing-csv-data-into-neo4j/" class="link ph2 pv2 db black">
            
          </a>
        </li>
      
        <li class="list f5 w-100 hover-bg-white nl1">
          
          <a href="/posts/more-biking-data/" class="link ph2 pv2 db black">
            
          </a>
        </li>
      
        <li class="list f5 w-100 hover-bg-white nl1">
          
          <a href="/posts/probability-binning-part-2-speeding-up-machine-learning/" class="link ph2 pv2 db black">
            
          </a>
        </li>
      
        <li class="list f5 w-100 hover-bg-white nl1">
          
          <a href="/posts/probability-binning-simple-and-fast/" class="link ph2 pv2 db black">
            
          </a>
        </li>
      
        <li class="list f5 w-100 hover-bg-white nl1">
          
          <a href="/posts/python-where-to-start/" class="link ph2 pv2 db black">
            
          </a>
        </li>
      
        <li class="list f5 w-100 hover-bg-white nl1">
          
          <a href="/posts/quick-and-dirty-plot-your-data-on-a-map/" class="link ph2 pv2 db black">
            
          </a>
        </li>
      
        <li class="list f5 w-100 hover-bg-white nl1">
          
          <a href="/posts/recursion-excursion/" class="link ph2 pv2 db black">
            
          </a>
        </li>
      
        <li class="list f5 w-100 hover-bg-white nl1">
          
          <a href="/posts/robustness-lessons-from-doing-applied-bench-science/" class="link ph2 pv2 db black">
            
          </a>
        </li>
      
        <li class="list f5 w-100 hover-bg-white nl1">
          
          <a href="/posts/shuffling-the-deck-an-interview-question/" class="link ph2 pv2 db black">
            
          </a>
        </li>
      
        <li class="list f5 w-100 hover-bg-white nl1">
          
          <a href="/posts/still-looking-for-a-job-advice-on-recruiting-/" class="link ph2 pv2 db black">
            
          </a>
        </li>
      
        <li class="list f5 w-100 hover-bg-white nl1">
          
          <a href="/posts/test-driven-data-pipelining/" class="link ph2 pv2 db black">
            
          </a>
        </li>
      
        <li class="list f5 w-100 hover-bg-white nl1">
          
          <a href="/posts/things-i-learned-about-pyspark-the-hard-way/" class="link ph2 pv2 db black">
            
          </a>
        </li>
      
        <li class="list f5 w-100 hover-bg-white nl1">
          
          <a href="/posts/things-i-learned-about-zip-files-last-week/" class="link ph2 pv2 db black">
            
          </a>
        </li>
      
        <li class="list f5 w-100 hover-bg-white nl1">
          
          <a href="/posts/things-i-learned-studying-the-cell-cycle-in-cancer/" class="link ph2 pv2 db black">
            
          </a>
        </li>
      
        <li class="list f5 w-100 hover-bg-white nl1">
          
          <a href="/posts/tips-on-giving-presentations/" class="link ph2 pv2 db black">
            
          </a>
        </li>
      
        <li class="list f5 w-100 hover-bg-white nl1">
          
          <a href="/posts/transitioning-to-data-science/" class="link ph2 pv2 db black">
            
          </a>
        </li>
      
        <li class="list f5 w-100 hover-bg-white nl1">
          
          <a href="/posts/validating-results/" class="link ph2 pv2 db black">
            
          </a>
        </li>
      
        <li class="list f5 w-100 hover-bg-white nl1">
          
          <a href="/posts/within-every-tutorial-is-another-tutorial/" class="link ph2 pv2 db black">
            
          </a>
        </li>
      
    </ul>
  </div>


    </aside>
  </div>

    </main>
    <footer class="bg-near-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="http://example.org/" >
    &copy; 2018 My New Hugo Site
  </a>
  








  </div>
</footer>

    <script src="http://example.org/dist/app.bundle.js" async></script>

  </body>
</html>
